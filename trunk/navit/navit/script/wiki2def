#! /bin/bash
rm -f item_def.h.wiki
rm -f osmmap_def.h.wiki
IFS="|"
echo "/* This file is generated from http://wiki.navit-project.org/index.php/Item_def.h, do not edit it, edit the wiki page instead */" >item_def.h.wiki
echo "/* This file is generated from http://wiki.navit-project.org/index.php/Item_def.h, do not edit it, edit the wiki page instead */" >osmmap_def.h.wiki
type="n"
wget -O - "http://wiki.navit-project.org/index.php/Item_def.h?action=edit" |
awk '/<textarea/,/<\/textarea/ { print $0 }' | 
grep "^| " |
sed -e 's/^| *//' -e 's/ *$//' -e 's/ *|/|/g' -e 's/| */|/g' -e 's/||/|/g' | 
while read id item description osmtags dummy
do
	if [[ "$id" == colspan=* ]]
	then
		echo "/* $item */" >>item_def.h.wiki
		continue
	fi
	if [[ -z "$id" ]]
	then
		echo "ITEM($item)" >>item_def.h.wiki
	else
		echo "ITEM2($id,$item)" >>item_def.h.wiki
		if [ "$id" == "0x80000000" ]
		then
			type="w"
		fi
	fi
	if [[ -n "$osmtags" ]]
	then
		for osmtag in $(echo "$osmtags" | sed 's/&lt;br\/&gt;/|/g')
		do
			printf '"%s\t%s\t%s\t%s\\n"\n' $type $osmtag $item >> osmmap_def.h.wiki
		done
	fi
done
exit 0
